<div class="container-event-overview">
  <div class="event-details">
    <img src="https://media.houseandgarden.co.uk/photos/63e11c8cb4cfdd5e8b831271/master/w_1600%2Cc_limit/B6M37H.jpg"
         class="event-show-image" alt="Market Image">

    <div class="event-info">
      <h1><%= @event.name %></h1>
      <p><%= @event.location %></p>
      <p><%= @event.start_time.strftime("%B %d, %Y %H:%M") %> - <%= @event.end_time.strftime("%B %d, %Y %H:%M") %></p>
<div class="map">
      <div style="width: 100%; height: 300px;"
           data-controller="map"
           data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>"
           data-map-marker-value="<%= @marker.to_json %>">
      </div>
    </div>
    </div>


  </div>
</div>

<div class="event-show-farmers">

  <div class="attendance-form">
    <% if user_signed_in? && current_user.farmer? %>
      <% if @event.event_attendances.exists?(farmer: current_user.farmer) %>
        <p>You are already attending this event.</p>
      <% else %>
        <%= simple_form_for [@event, EventAttendance.new] do |f| %>
          <div class="form-row">
            <div class="form-group">
              <%= f.input :start_time, include_seconds: false, class: "form-control" %>
            </div>
            <div class="form-group">
              <%= f.input :end_time, include_seconds: false, class: "form-control" %>
            </div>
          </div>
          <%= f.submit "Confirm Attendance", class: "btn btn-primary" %>
        <% end %>
      <% end %>
    <% end %>
  </div>

  <h2>Farmers Attending:</h2>
  <ul class="farmers-attendance-list">
    <% @event.event_attendances.each do |attendance| %>
      <li class="farmer-attendance-item">
        <img src="<%= attendance.farmer.user.avatar %>" alt="Farmer Avatar" class="farmer-avatar">
        <span class="farmer-name"><%= attendance.farmer.user.email %></span>
        <span class="attendance-time">
          (<%= attendance.start_time.strftime("%H:%M") %> - <%= attendance.end_time.strftime("%H:%M") %>)
        </span>
        <%= link_to "View Profile", farmer_path(attendance.farmer), class: "btn btn-primary btn-sm" %>
      </li>
    <% end %>
  </ul>
</div>
