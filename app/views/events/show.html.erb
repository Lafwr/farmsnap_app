<h1><%= @event.name %></h1>

<div class="attendance-form">
  <% if user_signed_in? && current_user.farmer? && !@event.event_attendances.find_by(farmer: current_user.farmer) %>
    <%= form_with model: [@event, EventAttendance.new] do |f| %>
      <div class="form-row">
        <div class="form-group">
          <label for="start_time">Start Time:</label>
          <%= f.time_select :start_time, include_seconds: false, class: "form-control" %>
        </div>
        <div class="form-group">
          <label for="end_time">End Time:</label>
          <%= f.time_select :end_time, include_seconds: false, class: "form-control" %>
        </div>
      </div>
      <%= f.submit "Confirm Attendance", class: "btn btn-primary" %>
    <% end %>
  <% else %>
    <p>You are already attending this event.</p>
  <% end %>
</div>


  <div class="container-event-overview">
  <div class="event-details">
    <img src="https://media.houseandgarden.co.uk/photos/63e11c8cb4cfdd5e8b831271/master/w_1600%2Cc_limit/B6M37H.jpg"
         class="event-show-image" alt="Market Image">
      <div class="event-info">
        <h1><%= @event.name %></h1>
        <h5 class="card-title">Borough Market</h5>
        <p><%= @event.location %></p>
        <p><%= @event.start_time.strftime("%B %d, %Y %H:%M") %> - <%= @event.end_time.strftime("%B %d, %Y %H:%M") %></p>
        <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>

        <!-- Add a separate div for the map -->
        <div class="mini-map-container">
          <div id="mini-map"
            data-controller="map"
            data-map-markers-value="<%= @markers.to_json %>"
            data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
          </div>
        </div>
      </div>

  </div>
</div>

<h2>Farmers Attending:</h2>
<ul class="farmers-attendance-list">
  <% @event.event_attendances.each do |attendance| %>
    <li class="farmer-attendance-item">
      <img src="<%= attendance.farmer.user.avatar %>" alt="Farmer Avatar" class="farmer-avatar">
      <span class="farmer-name"><%= attendance.farmer.user.email %></span>
      <span class="attendance-time">
        (<%= attendance.start_time.strftime("%H:%M") %> - <%= attendance.end_time.strftime("%H:%M") %>)
      </span>
      <%= link_to "View Profile", farmer_path(attendance.farmer), class: "btn btn-primary btn-sm" %>
    </li>
    </li>
  <% end %>
</ul>
