<h1>Welcome farmer ID</h1>
<h1><%= @farmer.user.email %>'s Profile</h1>
<p><%= @farmer.bio %></p>
<p><%= @farmer.location %></p>

<h3>Upcoming Events</h3>
<% if @upcoming_events.any? %>
  <ul>
    <% @upcoming_events.each do |event| %>
      <li>
        <strong><%= event.name %></strong> - <%= event.start_time.strftime("%B %d, %Y %I:%M %p") %> to <%= event.end_time.strftime("%I:%M %p") %>
        <%= button_to "Cancel Attendance", event_event_attendance_path(event, event_attendances.find_by(farmer: @farmer)), method: :delete, class: "btn btn-danger" %>
      </li>
    <% end %>
  </ul>
<% else %>
  <p>You have no upcoming events.</p>
<% end %>

<div class="main-profile-container">
  <div class="left-half">
    <div class="profile-card-container">
      <div class="profile-container" data-controller= "toggle">
        <%= cl_image_tag @farmer.photo.key, height: 150, width: 150, crop: :fill %>


        <div class="profile-paragraph">
          <p><strong>Bio:</strong> <%= @farmer.bio %></p>
          <p><strong>Locationüìç:</strong> <%= @farmer.location %></p>
          <p><strong>Rating: <%= @average_rating == 0 ? 0 : @average_rating %></strong></p>
        </div>



          <div data-toggle-target="form" class="hidden">
            <%= render 'update', farmer: @farmer %>
          </div>
        <% end %>
      </div>
    </div>

       <div class="container-review">
        <div class="star-rate">
          <div class="row">
            <div class="col-xs-4">

                  <%= simple_form_for( [@farmer, @review],  data: { controller: "submit" }) do |f| %>
                  <!-- Hidden input for rating -->
                  <%= f.hidden_field :rating, id: "rating-hidden", data: { controller: "star-rating" } %>

                  <!-- Textarea for review content -->
                  <%= f.input :content, as: :text, label: "Your Review:", input_html: { rows: 3, class: "form-control" } %>

                  <!-- Star Rating -->
                  <div class="star-rating" data-controller="star-rating">
                    <span class="star" data-action="mouseover->star-rating#highlight click->star-rating#select" data-value="1">‚òÖ</span>
                    <span class="star" data-action="mouseover->star-rating#highlight click->star-rating#select" data-value="2">‚òÖ</span>
                    <span class="star" data-action="mouseover->star-rating#highlight click->star-rating#select" data-value="3">‚òÖ</span>
                    <span class="star" data-action="mouseover->star-rating#highlight click->star-rating#select" data-value="4">‚òÖ</span>
                    <span class="star" data-action="mouseover->star-rating#highlight click->star-rating#select" data-value="5">‚òÖ</span>
                  </div>


                  <!-- Submit Button -->
                  <%= f.submit "Submit Review", class: "btn btn-dark mt-3" %>
                <% end %>

            </div>
          </div>
        </div>

        <hr>

        <div class="reviews-all">
          <p><strong>All reviews:</strong></p>
            <% if @reviews.present? %>
              <% @reviews.each do |review| %>
                  <%= review.content %>
                  <%= review.rating %>
                  comment_by: <%= review.user.first_name %>
                  <hr>
                <% end %>
            <% else %>
              <p>No reviews available yet.</p>
            <% end %>
        </div>
    </div>
  </div>

<div class="right-half">
     <div class="calendar-card-container">
        <div class="calendar-container">

          <div class="profile-calendar">
              <%= month_calendar(events: @event_attendance, end_attribute: :end_time) do |date, event_attendances| %>
              <%= date %>
                <% event_attendances.each do |event_attendance| %>
                  <i class="fa-solid fa-carrot calendar-icon"></i>
                 <div class="calendar-event-time"><%= event_attendance.start_time.strftime(("%H:%M")) %></div>
                 <div class="calendar-event-time"><%= event_attendance.end_time.strftime(("%H:%M")) %></div>
                <% end %>
            <% end %>
          </div>
        </div>
      </div>

    <div class="crates-card-container">
      <h3>My Crates</h3>

      <div id="carouselExample" class="carousel slide">
        <div class="carousel-inner">
        <% Crate.all.each_slice(3).with_index do |crates, index| %>
          <div class="carousel-item <%= "active" if index == 0%>">
          <div class="row justify-content-center">
            <% crates.each do |crate| %>
              <div class="carousel-card">
                <div class="card-category" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url(https://raw.githubusercontent.com/lewagon/fullstack-images/master/uikit/breakfast.jpg)">
                </div>
                <div class="card-div">
                  <strong><%= crate.name %></strong>
                  <p>¬£<%= crate.price %></p>
                <div class="carousel-price-button">
                  <%= link_to new_crate_order_path(crate) do %>
                    <button>
                        <div class="svg-wrapper-1">
                        <div class="svg-wrapper">
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              viewBox="0 0 24 24"
                              width="24"
                              height="24"
                            >
                              <path fill="none" d="M0 0h24v24H0z"></path>
                              <path
                                fill="currentColor"
                                d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z"
                              ></path>
                            </svg>
                        </div>
                      </div>
                      <span>Reserve</span>
                    </button>
                  <% end %>
                </div>
               </div>
              </div>
            <% end %>
            </div>
          </div>
        <% end %>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>

    </div>
  </div>
</div>
</div>
